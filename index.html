<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <title>Сотрудники</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f1115;
      color: #eaeaea;
      padding: 20px;
    }

    h1 {
      margin-bottom: 10px;
    }

    select {
      padding: 6px 10px;
      margin-bottom: 15px;
      background: #1a1d24;
      color: #fff;
      border: 1px solid #2a2e39;
      border-radius: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #161922;
      border-radius: 10px;
      overflow: hidden;
    }

    thead {
      background: #1f2430;
    }

    th,
    td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #2a2e39;
      border-right: 1px solid #2a2e39;
      font-size: 14px;
    }

    th:last-child,
    td:last-child {
      border-right: none;
    }

    th {
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }

    th:hover {
      background: #262b38;
    }

    tbody tr:hover {
      background: #1d2230;
    }

    img.avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .number {
      text-align: right;
    }

    .sort-indicator {
      margin-left: 6px;
      opacity: 0.6;
    }
  </style>
</head>

<body>

  <h1>Список сотрудников</h1>

  <select id="dateSelect"></select>

  <table id="table">
    <thead>
      <tr>
        <th data-key="image_url">Аватар</th>
        <th data-key="steam_name">Steam</th>
        <th data-key="name">Имя</th>
        <th data-key="family">Фамилия</th>
        <th data-key="country">Страна</th>
        <th data-key="city">Город</th>
        <th data-key="pokazatel">Показатель</th>
        <th data-key="year">Возраст</th>
        <th data-key="karma">Карма</th>
        <th data-key="karma_vtc">Карма VTC</th>
        <th data-key="point_m">Очки (мес)</th>
        <th data-key="point">Очки</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let rawData;
    let currentData = [];
    let sortKey = null;
    let sortDir = 1;

    fetch('data.json')
      .then(res => res.json())
      .then(data => {
        rawData = data.employees;
        initDates();
      });

    function initDates() {
      const select = document.getElementById('dateSelect');
      Object.keys(rawData)
        .sort((a, b) => new Date(a.split('.').reverse().join('-')) - new Date(b.split('.').reverse().join('-')))
        .forEach(date => {
          const option = document.createElement('option');
          option.value = date;
          option.textContent = date;
          select.appendChild(option);
        });

      select.addEventListener('change', () => {
        loadDate(select.value);
      });

      loadDate(select.value);
    }

    function loadDate(date) {
      currentData = [...rawData[date]];
      renderTable();
    }

    function renderTable() {
      const tbody = document.querySelector('tbody');
      tbody.innerHTML = '';

      currentData.forEach(item => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
      <td><img class="avatar" src="${item.image_url}" alt=""></td>
      <td>${item.steam_name}</td>
      <td>${item.name}</td>
      <td>${item.family}</td>
      <td>${item.country}</td>
      <td>${item.city}</td>
      <td class="number">${Number(item.pokazatel)}</td>
      <td class="number">${item.year}</td>
      <td class="number">${item.karma}</td>
      <td class="number">${item.karma_vtc}</td>
      <td class="number">${item.point_m}</td>
      <td class="number">${item.point}</td>
    `;

        tbody.appendChild(tr);
      });
    }

    function sortBy(key) {
      if (sortKey === key) {
        sortDir *= -1;
      } else {
        sortKey = key;
        sortDir = 1;
      }

      currentData.sort((a, b) => {
        let valA = a[key];
        let valB = b[key];

        if (!isNaN(valA) && !isNaN(valB)) {
          return (Number(valA) - Number(valB)) * sortDir;
        }

        return String(valA).localeCompare(String(valB), 'ru') * sortDir;
      });

      renderTable();
    }

    // обработка кликов по заголовкам
    document.querySelectorAll('th').forEach(th => {
      const key = th.dataset.key;
      if (!key || key === 'image_url') return;

      th.addEventListener('click', () => sortBy(key));
    });
  </script>

</body>

</html>